<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bible App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.min.js"
      integrity="sha384-VQqxDN0EQCkWoxt/0vsQvZswzTHUVOImccYmSyhJTp7kGtPed0Qcx8rK9h9YEgx+"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <h1>Hello, world!</h1>

    <!-- Bible Version Dropdown -->
    <select
      id="bible-version-select"
      class="form-select"
      aria-label="Default select example"
    ></select>

    <!-- Search words or phrase -->
    <div class="input-group">
      <div class="form-outline">
        <input placeholder="Search" type="search" id="form1" class="form-control" />
      </div>
      <button type="button" class="btn btn-primary"></button>
    </div>

    <!-- Select book -->

    <select id="book-select" class="form-select" aria-label="Default select example"></select>

    <!-- Chapter Select -->

    <select id="chapter-select" class="form-select" aria-label="Default select example">
      <option selected>Open this select menu</option>
      <option value="1">One</option>
      <option value="2">Two</option>
      <option value="3">Three</option>
    </select>
  </body>

  <script>
    let versionsList = []
    let booksList=[]

    async function getVersionsList() {
      const response = await fetch("https://api.scripture.api.bible/v1/bibles?language=eng", {
        method: "GET",
        headers: {
          accept: "application/json",
          "api-key": "fac23defb4f49d2756c6c13b3be90de8",
        },
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      //console.log(data.data);
      const versions = data.data.map((version) => ({
        id: version.id,
        name: version.name,
      }));
      //console.log(versions);
      return versions;
    }

    async function getBooksList(version) {
      const response = await fetch(
        `https://api.scripture.api.bible/v1/bibles/${version}/books?include-chapters=true`,
        {
          method: "GET",
          headers: {
            accept: "application/json",
            "api-key": "fac23defb4f49d2756c6c13b3be90de8",
          },
        }
      );

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      const books = data.data.map((book) => ({
        id: book.id,
        name: book.name,
        chapters: book.chapters,
      }));
      console.log(books);
      return books;
    }

    async function init(){
        versionsList = await getVersionsList()
        booksList = await getBooksList()
    }
    //POPULATING THE VERSION SELECT
    const versionSelect = document.getElementById("bible-version-select");
    const bookSelect = document.getElementById("book-select");
    const chapterSelect = document.getElementById("chapter-select");
    getVersionsList().then((versions) => {
      //console.log(versions);
      const defaultVersion = versions[0].id;

      versions.forEach((version, index) => {
        const selected = index == 0 ? "selected" : "";
        const option = `<option value="${version.id}" ${selected}>${version.name}</option>`;
        versionSelect.innerHTML += option;
      });
      console.log(defaultVersion);
      getBooksList(defaultVersion).then((books) => {
        books.forEach((book) => {
          const option = `<option value="${book.id}">${book.name}</option>`;
          bookSelect.innerHTML += option;
        });
      });
    });

    function updateChapters(bookID) {
        let chapters=[]
        for(const book in books)
    }
  </script>
</html>
